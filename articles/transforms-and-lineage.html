<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Transforms and Data Lineage • ontologyR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transforms and Data Lineage">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ontologyR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/datasets-and-materialization.html">Datasets and Materialization</a></li>
    <li><a class="dropdown-item" href="../articles/end-to-end-workflow.html">End-to-End Workflow: From Data to Governed Definitions</a></li>
    <li><a class="dropdown-item" href="../articles/governance-gates.html">Governance Gates and Access Control</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction to ontologyR</a></li>
    <li><a class="dropdown-item" href="../articles/transforms-and-lineage.html">Transforms and Data Lineage</a></li>
    <li><a class="dropdown-item" href="../articles/what-is-an-ontology.html">What is an Ontology? A Plain-English Guide</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CathalByrneGit/ontologyR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Transforms and Data Lineage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CathalByrneGit/ontologyR/blob/main/vignettes/transforms-and-lineage.Rmd" class="external-link"><code>vignettes/transforms-and-lineage.Rmd</code></a></small>
      <div class="d-none name"><code>transforms-and-lineage.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-assembly-line-analogy">The Assembly Line Analogy<a class="anchor" aria-label="anchor" href="#the-assembly-line-analogy"></a>
</h2>
<p>Imagine a car factory:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Station 1</strong>: Raw steel arrives, gets cut into body
panels</li>
<li>
<strong>Station 2</strong>: Body panels get welded together into a
frame</li>
<li>
<strong>Station 3</strong>: Frame gets painted</li>
<li>
<strong>Station 4</strong>: Engine and interior are installed</li>
<li>
<strong>Station 5</strong>: Final inspection, car rolls off the
line</li>
</ol>
<p>Each station is a <strong>transform</strong> — it takes inputs and
produces outputs. The path from raw steel to finished car is the
<strong>lineage</strong>.</p>
<p><strong>ontologyR transforms work the same way</strong> — they define
how data flows from sources to outputs, with full traceability.</p>
<hr>
</div>
<div class="section level2">
<h2 id="why-transforms-matter">Why Transforms Matter<a class="anchor" aria-label="anchor" href="#why-transforms-matter"></a>
</h2>
<p>Without transforms, data pipelines look like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">-- dashboard_query.sql (written 3 years ago, nobody knows what it does)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="kw">SELECT</span> a.<span class="op">*</span>, b.total, c.status</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="kw">FROM</span> some_table a</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span> <span class="op">..</span>. <span class="kw">FROM</span> other_table <span class="op">..</span>.) b <span class="kw">ON</span> a.<span class="kw">id</span> <span class="op">=</span> b.<span class="kw">id</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span> <span class="op">..</span>. <span class="kw">FROM</span> yet_another <span class="op">..</span>.) c <span class="kw">ON</span> a.<span class="kw">id</span> <span class="op">=</span> c.<span class="kw">id</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="kw">WHERE</span> <span class="op">..</span>.</span></code></pre></div>
<p>Problems: - What tables does this actually use? - If
<code>other_table</code> changes schema, does this break? - How long
does this take to run? - When did the logic last change?</p>
<p><strong>Transforms solve this</strong> by making data transformations
explicit, tracked, and reproducible.</p>
<hr>
</div>
<div class="section level2">
<h2 id="defining-a-transform">Defining a Transform<a class="anchor" aria-label="anchor" href="#defining-a-transform"></a>
</h2>
<p>A transform is a named, tracked data transformation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CathalByrneGit/ontologyR" class="external-link">ontologyR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_connect.html">ont_connect</a></span><span class="op">(</span><span class="st">":memory:"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assume we have some source tables</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="fu"><a href="../reference/ont_get_connection.html">ont_get_connection</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"orders"</span>, <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  order_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"O"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  amount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">10</span>, <span class="fl">500</span><span class="op">)</span>,</span>
<span>  order_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">90</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="fu"><a href="../reference/ont_get_connection.html">ont_get_connection</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"customers"</span>, <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Customer"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span>,</span>
<span>  segment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Enterprise"</span>, <span class="st">"SMB"</span>, <span class="st">"Consumer"</span><span class="op">)</span>, <span class="fl">20</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Register source datasets</span></span>
<span><span class="fu">ont_register_dataset</span><span class="op">(</span><span class="st">"ds_orders"</span>, <span class="st">"Orders"</span>, <span class="st">"orders"</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="fu">ont_register_dataset</span><span class="op">(</span><span class="st">"ds_customers"</span>, <span class="st">"Customers"</span>, <span class="st">"customers"</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a transform that joins them</span></span>
<span><span class="fu">ont_define_transform</span><span class="op">(</span></span>
<span>  transform_id <span class="op">=</span> <span class="st">"txf_order_summary"</span>,</span>
<span>  transform_name <span class="op">=</span> <span class="st">"Order Summary by Customer"</span>,</span>
<span>  output_dataset_id <span class="op">=</span> <span class="st">"ds_order_summary"</span>,</span>
<span>  transform_type <span class="op">=</span> <span class="st">"sql"</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">    SELECT</span></span>
<span><span class="st">      c.customer_id,</span></span>
<span><span class="st">      c.name,</span></span>
<span><span class="st">      c.segment,</span></span>
<span><span class="st">      COUNT(o.order_id) as order_count,</span></span>
<span><span class="st">      SUM(o.amount) as total_spent,</span></span>
<span><span class="st">      MAX(o.order_date) as last_order</span></span>
<span><span class="st">    FROM customers c</span></span>
<span><span class="st">    LEFT JOIN orders o ON c.customer_id = o.customer_id</span></span>
<span><span class="st">    GROUP BY c.customer_id, c.name, c.segment</span></span>
<span><span class="st">  "</span>,</span>
<span>  input_datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ds_orders"</span>, <span class="st">"ds_customers"</span><span class="op">)</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Aggregates order data by customer for reporting"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="the-recipe-card-analogy">The Recipe Card Analogy<a class="anchor" aria-label="anchor" href="#the-recipe-card-analogy"></a>
</h3>
<p>A transform is like a recipe card: - <strong>Name</strong>:
“Chocolate Chip Cookies” - <strong>Ingredients</strong> (inputs): flour,
butter, chocolate chips - <strong>Instructions</strong> (code): mix,
bake at 350F for 12 min - <strong>Result</strong> (output): cookies</p>
<p>The recipe card doesn’t make cookies — it describes HOW to make them.
Similarly, a transform definition describes the transformation but
doesn’t execute it.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="executing-transforms">Executing Transforms<a class="anchor" aria-label="anchor" href="#executing-transforms"></a>
</h2>
<p>To actually run the transform:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Execute the transform</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_order_summary"</span><span class="op">)</span></span>
<span><span class="co">#&gt; v Executed transform txf_order_summary</span></span>
<span><span class="co">#&gt; i 20 rows in 0.12 seconds</span></span>
<span></span>
<span><span class="co"># Check the result</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt; $run_id</span></span>
<span><span class="co">#&gt; [1] "RUN-20250116-abc123"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $transform_id</span></span>
<span><span class="co">#&gt; [1] "txf_order_summary"</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $row_count</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] "completed"</span></span></code></pre></div>
<p>Each execution: - Creates a <strong>run record</strong> (who, when,
how long) - Captures <strong>input snapshots</strong> (what the inputs
looked like) - Creates <strong>lineage edges</strong> (what flowed
where) - Updates the <strong>output dataset</strong> metadata</p>
<hr>
</div>
<div class="section level2">
<h2 id="input-snapshots-reproducibility">Input Snapshots: Reproducibility<a class="anchor" aria-label="anchor" href="#input-snapshots-reproducibility"></a>
</h2>
<p>Here’s something powerful: every run captures a snapshot of its
inputs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get run details</span></span>
<span><span class="va">run</span> <span class="op">&lt;-</span> <span class="fu">ont_get_run</span><span class="op">(</span><span class="st">"RUN-20250116-abc123"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># See what the inputs looked like at execution time</span></span>
<span><span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">run</span><span class="op">$</span><span class="va">input_snapshot</span><span class="op">)</span></span>
<span><span class="co">#&gt; $ds_orders</span></span>
<span><span class="co">#&gt; $ds_orders$row_count</span></span>
<span><span class="co">#&gt; [1] 100</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; $ds_customers</span></span>
<span><span class="co">#&gt; $ds_customers$row_count</span></span>
<span><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<p>This answers: <strong>“When this report was generated, what data was
it based on?”</strong></p>
<div class="section level3">
<h3 id="the-photograph-analogy">The Photograph Analogy<a class="anchor" aria-label="anchor" href="#the-photograph-analogy"></a>
</h3>
<p>Input snapshots are like taking a photograph of your ingredients
before cooking. If the cookies taste weird, you can look at the photo
and say “Ah, we only had 50g of butter that day instead of 100g.”</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="building-transform-chains">Building Transform Chains<a class="anchor" aria-label="anchor" href="#building-transform-chains"></a>
</h2>
<p>Real data pipelines have multiple steps. ontologyR tracks the full
chain:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Clean orders (remove test orders)</span></span>
<span><span class="fu">ont_define_transform</span><span class="op">(</span></span>
<span>  <span class="st">"txf_clean_orders"</span>, <span class="st">"Clean Orders"</span>, <span class="st">"ds_clean_orders"</span>, <span class="st">"sql"</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"SELECT * FROM orders WHERE amount &gt; 0 AND customer_id NOT LIKE 'TEST%'"</span>,</span>
<span>  input_datasets <span class="op">=</span> <span class="st">"ds_orders"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_clean_orders"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Aggregate by customer</span></span>
<span><span class="fu">ont_define_transform</span><span class="op">(</span></span>
<span>  <span class="st">"txf_customer_totals"</span>, <span class="st">"Customer Totals"</span>, <span class="st">"ds_customer_totals"</span>, <span class="st">"sql"</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"SELECT customer_id, SUM(amount) as total FROM ds_clean_orders GROUP BY customer_id"</span>,</span>
<span>  input_datasets <span class="op">=</span> <span class="st">"ds_clean_orders"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_customer_totals"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Segment customers</span></span>
<span><span class="fu">ont_define_transform</span><span class="op">(</span></span>
<span>  <span class="st">"txf_customer_segments"</span>, <span class="st">"Customer Segments"</span>, <span class="st">"ds_customer_segments"</span>, <span class="st">"sql"</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">    SELECT customer_id, total,</span></span>
<span><span class="st">           CASE WHEN total &gt; 1000 THEN 'Gold'</span></span>
<span><span class="st">                WHEN total &gt; 500 THEN 'Silver'</span></span>
<span><span class="st">                ELSE 'Bronze' END as tier</span></span>
<span><span class="st">    FROM ds_customer_totals</span></span>
<span><span class="st">  "</span>,</span>
<span>  input_datasets <span class="op">=</span> <span class="st">"ds_customer_totals"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_customer_segments"</span><span class="op">)</span></span></code></pre></div>
<p>Now you have a three-step pipeline, fully tracked.</p>
<hr>
</div>
<div class="section level2">
<h2 id="visualizing-the-dag">Visualizing the DAG<a class="anchor" aria-label="anchor" href="#visualizing-the-dag"></a>
</h2>
<p>Your transforms form a <strong>Directed Acyclic Graph</strong> (DAG)
— data flows in one direction, no cycles.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the transform graph</span></span>
<span><span class="va">dag</span> <span class="op">&lt;-</span> <span class="fu">ont_get_transform_dag</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dag</span><span class="op">$</span><span class="va">nodes</span></span>
<span><span class="co">#&gt; # A tibble: 7 x 3</span></span>
<span><span class="co">#&gt;   node_id             node_type label</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;     &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 txf_clean_orders    transform Clean Orders</span></span>
<span><span class="co">#&gt; 2 txf_customer_totals transform Customer Totals</span></span>
<span><span class="co">#&gt; 3 txf_customer_segments transform Customer Segments</span></span>
<span><span class="co">#&gt; 4 ds_orders           source    Orders</span></span>
<span><span class="co">#&gt; 5 ds_clean_orders     derived   Clean Orders</span></span>
<span><span class="co">#&gt; 6 ds_customer_totals  derived   Customer Totals</span></span>
<span><span class="co">#&gt; 7 ds_customer_segments derived  Customer Segments</span></span>
<span></span>
<span><span class="va">dag</span><span class="op">$</span><span class="va">edges</span></span>
<span><span class="co">#&gt; # A tibble: 6 x 3</span></span>
<span><span class="co">#&gt;   from                to                    edge_type</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;               &lt;chr&gt;                 &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 ds_orders           txf_clean_orders      primary</span></span>
<span><span class="co">#&gt; 2 txf_clean_orders    ds_clean_orders       output</span></span>
<span><span class="co">#&gt; 3 ds_clean_orders     txf_customer_totals   primary</span></span>
<span><span class="co">#&gt; ...</span></span></code></pre></div>
<p>This is like a <strong>subway map</strong> for your data — you can
see all the routes and stations.</p>
<hr>
</div>
<div class="section level2">
<h2 id="impact-analysis-what-will-break">Impact Analysis: What Will Break?<a class="anchor" aria-label="anchor" href="#impact-analysis-what-will-break"></a>
</h2>
<p>The killer feature is <strong>impact analysis</strong>. Before
changing anything, see what depends on it:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># What happens if I change the orders table?</span></span>
<span><span class="va">impact</span> <span class="op">&lt;-</span> <span class="fu">ont_get_impact</span><span class="op">(</span><span class="st">"ds_orders"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">impact</span><span class="op">$</span><span class="va">total_affected_datasets</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span></span>
<span><span class="va">impact</span><span class="op">$</span><span class="va">total_affected_transforms</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span></span>
<span><span class="va">impact</span><span class="op">$</span><span class="va">direct_transforms</span></span>
<span><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span><span class="co">#&gt;   transform_id     transform_name</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 txf_clean_orders Clean Orders</span></span>
<span></span>
<span><span class="va">impact</span><span class="op">$</span><span class="va">all_affected_transforms</span></span>
<span><span class="co">#&gt; # A tibble: 3 x 2</span></span>
<span><span class="co">#&gt;   transform_id          transform_name</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                 &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 txf_clean_orders      Clean Orders</span></span>
<span><span class="co">#&gt; 2 txf_customer_totals   Customer Totals</span></span>
<span><span class="co">#&gt; 3 txf_customer_segments Customer Segments</span></span></code></pre></div>
<div class="section level3">
<h3 id="the-domino-analogy">The Domino Analogy<a class="anchor" aria-label="anchor" href="#the-domino-analogy"></a>
</h3>
<p>Impact analysis shows you the dominoes. Push one, and you can see
which ones will fall.</p>
<p>Without this: “I’ll just change this column…” <em>three dashboards
break</em></p>
<p>With this: “This column is used by 3 transforms feeding 2 dashboards.
Let me coordinate the change.”</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparing-runs-what-changed">Comparing Runs: What Changed?<a class="anchor" aria-label="anchor" href="#comparing-runs-what-changed"></a>
</h2>
<p>When numbers look different, you can compare runs:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the transform twice (maybe data changed)</span></span>
<span><span class="va">result1</span> <span class="op">&lt;-</span> <span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_customer_totals"</span><span class="op">)</span></span>
<span><span class="co"># ... time passes, data changes ...</span></span>
<span><span class="va">result2</span> <span class="op">&lt;-</span> <span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_customer_totals"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare them</span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu">ont_compare_runs</span><span class="op">(</span><span class="va">result1</span><span class="op">$</span><span class="va">run_id</span>, <span class="va">result2</span><span class="op">$</span><span class="va">run_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison</span><span class="op">$</span><span class="va">output_row_diff</span></span>
<span><span class="co">#&gt; [1] 5  # 5 more customers this time</span></span>
<span></span>
<span><span class="va">comparison</span><span class="op">$</span><span class="va">input_changes</span></span>
<span><span class="co">#&gt; Shows row count changes in inputs</span></span></code></pre></div>
<p>This answers: <strong>“Why does today’s report show different numbers
than yesterday’s?”</strong></p>
<hr>
</div>
<div class="section level2">
<h2 id="dag-validation-catch-errors-early">DAG Validation: Catch Errors Early<a class="anchor" aria-label="anchor" href="#dag-validation-catch-errors-early"></a>
</h2>
<p>ontologyR can validate your transform graph:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check for cycles (impossible data flows)</span></span>
<span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu">ont_validate_dag</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">validation</span><span class="op">$</span><span class="va">is_valid</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">validation</span><span class="op">$</span><span class="va">cycles</span></span>
<span><span class="co">#&gt; list()  # No cycles - good!</span></span></code></pre></div>
<p>If you accidentally create a circular dependency (A depends on B, B
depends on C, C depends on A), validation catches it before you waste
time debugging.</p>
<hr>
</div>
<div class="section level2">
<h2 id="practical-example-sales-analytics-pipeline">Practical Example: Sales Analytics Pipeline<a class="anchor" aria-label="anchor" href="#practical-example-sales-analytics-pipeline"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CathalByrneGit/ontologyR" class="external-link">ontologyR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_connect.html">ont_connect</a></span><span class="op">(</span><span class="st">":memory:"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Source Data ===</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="fu"><a href="../reference/ont_get_connection.html">ont_get_connection</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"raw_transactions"</span>, <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  txn_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>,</span>
<span>  product_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>, <span class="fl">1000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  quantity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  unit_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">5</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  txn_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">365</span>, <span class="fl">1000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="fu"><a href="../reference/ont_get_connection.html">ont_get_connection</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"products"</span>, <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  product_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,</span>
<span>  product_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Product"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>,</span>
<span>  category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Electronics"</span>, <span class="st">"Clothing"</span>, <span class="st">"Food"</span><span class="op">)</span>, <span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Register Sources ===</span></span>
<span><span class="fu">ont_register_dataset</span><span class="op">(</span><span class="st">"ds_transactions"</span>, <span class="st">"Transactions"</span>, <span class="st">"raw_transactions"</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span><span class="fu">ont_register_dataset</span><span class="op">(</span><span class="st">"ds_products"</span>, <span class="st">"Products"</span>, <span class="st">"products"</span>, <span class="st">"source"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Build Pipeline ===</span></span>
<span></span>
<span><span class="co"># Step 1: Calculate line totals</span></span>
<span><span class="fu">ont_define_transform</span><span class="op">(</span></span>
<span>  <span class="st">"txf_line_totals"</span>, <span class="st">"Line Totals"</span>, <span class="st">"ds_line_totals"</span>, <span class="st">"sql"</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"SELECT *, quantity * unit_price as line_total FROM raw_transactions"</span>,</span>
<span>  input_datasets <span class="op">=</span> <span class="st">"ds_transactions"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Enrich with product info</span></span>
<span><span class="fu">ont_define_transform</span><span class="op">(</span></span>
<span>  <span class="st">"txf_enriched_sales"</span>, <span class="st">"Enriched Sales"</span>, <span class="st">"ds_enriched_sales"</span>, <span class="st">"sql"</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">    SELECT t.*, p.product_name, p.category</span></span>
<span><span class="st">    FROM ds_line_totals t</span></span>
<span><span class="st">    JOIN products p ON t.product_id = p.product_id</span></span>
<span><span class="st">  "</span>,</span>
<span>  input_datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ds_line_totals"</span>, <span class="st">"ds_products"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Aggregate by category</span></span>
<span><span class="fu">ont_define_transform</span><span class="op">(</span></span>
<span>  <span class="st">"txf_category_summary"</span>, <span class="st">"Category Summary"</span>, <span class="st">"ds_category_summary"</span>, <span class="st">"sql"</span>,</span>
<span>  code <span class="op">=</span> <span class="st">"</span></span>
<span><span class="st">    SELECT category,</span></span>
<span><span class="st">           COUNT(*) as transactions,</span></span>
<span><span class="st">           SUM(line_total) as revenue</span></span>
<span><span class="st">    FROM ds_enriched_sales</span></span>
<span><span class="st">    GROUP BY category</span></span>
<span><span class="st">  "</span>,</span>
<span>  input_datasets <span class="op">=</span> <span class="st">"ds_enriched_sales"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Execute Pipeline ===</span></span>
<span><span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_line_totals"</span><span class="op">)</span></span>
<span><span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_enriched_sales"</span><span class="op">)</span></span>
<span><span class="fu">ont_execute_transform</span><span class="op">(</span><span class="st">"txf_category_summary"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Analyze ===</span></span>
<span><span class="co"># Full lineage from source to summary</span></span>
<span><span class="fu">ont_get_upstream</span><span class="op">(</span><span class="st">"ds_category_summary"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Shows: transactions -&gt; line_totals -&gt; enriched_sales -&gt; category_summary</span></span>
<span><span class="co">#&gt;        products -&gt; enriched_sales -&gt; category_summary</span></span>
<span></span>
<span><span class="co"># Impact if products table changes</span></span>
<span><span class="fu">ont_get_impact</span><span class="op">(</span><span class="st">"ds_products"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Shows: enriched_sales and category_summary would be affected</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="key-concepts-summary">Key Concepts Summary<a class="anchor" aria-label="anchor" href="#key-concepts-summary"></a>
</h2>
<table class="table">
<colgroup>
<col width="31%">
<col width="37%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Concept</th>
<th>What It Is</th>
<th>Analogy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Transform</strong></td>
<td>Named data transformation</td>
<td>Recipe card</td>
</tr>
<tr class="even">
<td><strong>Input Dataset</strong></td>
<td>Data source for transform</td>
<td>Ingredients</td>
</tr>
<tr class="odd">
<td><strong>Output Dataset</strong></td>
<td>Result of transform</td>
<td>Finished dish</td>
</tr>
<tr class="even">
<td><strong>Run</strong></td>
<td>Single execution of transform</td>
<td>One batch of cooking</td>
</tr>
<tr class="odd">
<td><strong>Input Snapshot</strong></td>
<td>State of inputs at run time</td>
<td>Photo of ingredients</td>
</tr>
<tr class="even">
<td><strong>Lineage</strong></td>
<td>Graph of data dependencies</td>
<td>Family tree</td>
</tr>
<tr class="odd">
<td><strong>DAG</strong></td>
<td>The full transform graph</td>
<td>Subway map</td>
</tr>
<tr class="even">
<td><strong>Impact Analysis</strong></td>
<td>What depends on X</td>
<td>Domino prediction</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>See <code><a href="../articles/datasets-and-materialization.html">vignette("datasets-and-materialization")</a></code> for
concept-based materialization</li>
<li>See <code><a href="../articles/governance-gates.html">vignette("governance-gates")</a></code> for quality controls
on transforms</li>
</ul>
<p>Remember: <strong>The goal isn’t just to move data — it’s to
understand how data moves.</strong></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cathal Byrne.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
