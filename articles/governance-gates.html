<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Governance Gates and Access Control • ontologyR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Governance Gates and Access Control">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ontologyR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-guides">
<li><h6 class="dropdown-header" data-toc-skip>Conceptual Overview</h6></li>
    <li><a class="dropdown-item" href="../articles/what-is-an-ontology.html">What is an Ontology?</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Core Features</h6></li>
    <li><a class="dropdown-item" href="../articles/datasets-and-materialization.html">Datasets &amp; Materialization</a></li>
    <li><a class="dropdown-item" href="../articles/transforms-and-lineage.html">Transforms &amp; Lineage</a></li>
    <li><a class="dropdown-item" href="../articles/governance-gates.html">Governance Gates</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Complete Example</h6></li>
    <li><a class="dropdown-item" href="../articles/end-to-end-workflow.html">End-to-End Workflow</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CathalByrneGit/ontologyR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Governance Gates and Access Control</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CathalByrneGit/ontologyR/blob/main/vignettes/governance-gates.Rmd" class="external-link"><code>vignettes/governance-gates.Rmd</code></a></small>
      <div class="d-none name"><code>governance-gates.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-airport-security-analogy">The Airport Security Analogy<a class="anchor" aria-label="anchor" href="#the-airport-security-analogy"></a>
</h2>
<p>When you travel by plane, you don’t just walk onto the aircraft. You
pass through <strong>gates</strong>:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Ticket Check</strong>: Do you have a valid booking?</li>
<li>
<strong>Security Screening</strong>: Any prohibited items?</li>
<li>
<strong>Passport Control</strong>: Are you authorized to
travel?</li>
<li>
<strong>Boarding</strong>: Is it your flight’s turn?</li>
</ol>
<p>Each gate has a specific purpose. Fail any one, and you can’t
proceed.</p>
<p><strong>ontologyR governance gates work the same way</strong> —
they’re checkpoints that data definitions must pass before being
promoted to production.</p>
<hr>
</div>
<div class="section level2">
<h2 id="the-problem-cowboy-data-changes">The Problem: Cowboy Data Changes<a class="anchor" aria-label="anchor" href="#the-problem-cowboy-data-changes"></a>
</h2>
<p>Without governance, data changes often happen like this:</p>
<blockquote>
<p>“Hey, I updated the ‘active customer’ definition in the dashboard.”
“Wait, did anyone review that?” “Review? I just changed the SQL.” “That
dashboard feeds into our board report…” <em>chaos ensues</em></p>
</blockquote>
<p>Governance gates prevent this by requiring: - <strong>Audit
coverage</strong> before activation - <strong>No unresolved
drift</strong> events - <strong>Approval from authorized
users</strong></p>
<hr>
</div>
<div class="section level2">
<h2 id="built-in-governance-gates">Built-in Governance Gates<a class="anchor" aria-label="anchor" href="#built-in-governance-gates"></a>
</h2>
<p>ontologyR comes with three default gates:</p>
<div class="section level3">
<h3 id="audit-coverage-gate">1. Audit Coverage Gate<a class="anchor" aria-label="anchor" href="#audit-coverage-gate"></a>
</h3>
<p><strong>Purpose</strong>: Ensure definitions have been tested against
reality.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default settings</span></span>
<span><span class="co">#&gt; min_audits: 10</span></span>
<span><span class="co">#&gt; min_agreement_rate: 0.9 (90%)</span></span>
<span></span>
<span><span class="co"># This gate asks:</span></span>
<span><span class="co"># - Has this concept been audited at least 10 times?</span></span>
<span><span class="co"># - Do humans agree with the system at least 90% of the time?</span></span></code></pre></div>
<p><strong>The Restaurant Analogy</strong>: You wouldn’t put a new dish
on the menu without having taste-testers try it first. The audit
coverage gate ensures definitions have been “taste-tested” before going
live.</p>
</div>
<div class="section level3">
<h3 id="no-open-drift-gate">2. No Open Drift Gate<a class="anchor" aria-label="anchor" href="#no-open-drift-gate"></a>
</h3>
<p><strong>Purpose</strong>: Block changes if there’s unresolved
drift.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default settings</span></span>
<span><span class="co">#&gt; max_open_drift_events: 0</span></span>
<span></span>
<span><span class="co"># This gate asks:</span></span>
<span><span class="co"># - Are there any open drift events for this concept?</span></span>
<span><span class="co"># - Has someone investigated why audits are disagreeing?</span></span></code></pre></div>
<p><strong>The Fire Alarm Analogy</strong>: You can’t ignore a fire
alarm and proceed with business as usual. Open drift events are like
fire alarms — they need to be acknowledged and resolved.</p>
</div>
<div class="section level3">
<h3 id="approval-required-gate">3. Approval Required Gate<a class="anchor" aria-label="anchor" href="#approval-required-gate"></a>
</h3>
<p><strong>Purpose</strong>: Require human sign-off before
promotion.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default settings</span></span>
<span><span class="co">#&gt; min_approvals: 1</span></span>
<span><span class="co">#&gt; approver_roles: ["approver", "admin"]</span></span>
<span></span>
<span><span class="co"># This gate asks:</span></span>
<span><span class="co"># - Has someone with authority approved this change?</span></span></code></pre></div>
<p><strong>The Sign-off Analogy</strong>: Important documents need
signatures. The approval gate ensures critical data definitions have
proper authorization.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="checking-gates">Checking Gates<a class="anchor" aria-label="anchor" href="#checking-gates"></a>
</h2>
<p>Before activating a concept version, check if it passes all
gates:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CathalByrneGit/ontologyR" class="external-link">ontologyR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_connect.html">ont_connect</a></span><span class="op">(</span><span class="st">":memory:"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Setup: Create a concept</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="fu"><a href="../reference/ont_get_connection.html">ont_get_connection</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"patients"</span>, <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  patient_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">18</span><span class="op">:</span><span class="fl">90</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  risk_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_register_object.html">ont_register_object</a></span><span class="op">(</span><span class="st">"Patient"</span>, <span class="st">"patients"</span>, <span class="st">"patient_id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_define_concept.html">ont_define_concept</a></span><span class="op">(</span><span class="st">"high_risk"</span>, <span class="st">"Patient"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_add_version.html">ont_add_version</a></span><span class="op">(</span><span class="st">"high_risk"</span>, <span class="st">"clinical"</span>, <span class="fl">1</span>,</span>
<span>                sql_expr <span class="op">=</span> <span class="st">"risk_score &gt; 0.7"</span>,</span>
<span>                status <span class="op">=</span> <span class="st">"draft"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check all gates before activation</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ont_check_all_gates</span><span class="op">(</span></span>
<span>  concept_id <span class="op">=</span> <span class="st">"high_risk"</span>,</span>
<span>  scope <span class="op">=</span> <span class="st">"clinical"</span>,</span>
<span>  version <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  action_type <span class="op">=</span> <span class="st">"activation"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">overall_passed</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">blocking_failures</span></span>
<span><span class="co">#&gt; $gate_audit_coverage</span></span>
<span><span class="co">#&gt; $gate_audit_coverage$passed</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; $gate_audit_coverage$details</span></span>
<span><span class="co">#&gt; $gate_audit_coverage$details$audit_count</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; $gate_audit_coverage$details$required_audits</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>The concept can’t be activated yet because it hasn’t been
audited.</p>
<hr>
</div>
<div class="section level2">
<h2 id="satisfying-gates">Satisfying Gates<a class="anchor" aria-label="anchor" href="#satisfying-gates"></a>
</h2>
<div class="section level3">
<h3 id="satisfying-the-audit-coverage-gate">Satisfying the Audit Coverage Gate<a class="anchor" aria-label="anchor" href="#satisfying-the-audit-coverage-gate"></a>
</h3>
<p>Record audits to build up coverage:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample patients and have clinicians review</span></span>
<span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ont_sample_for_audit.html">ont_sample_for_audit</a></span><span class="op">(</span><span class="st">"high_risk"</span>, <span class="st">"clinical"</span>, n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Record their judgments</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/ont_record_audit.html">ont_record_audit</a></span><span class="op">(</span></span>
<span>    <span class="st">"high_risk"</span>, <span class="st">"clinical"</span>, <span class="fl">1</span>,</span>
<span>    object_key <span class="op">=</span> <span class="va">sample</span><span class="op">$</span><span class="va">patient_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    system_value <span class="op">=</span> <span class="va">sample</span><span class="op">$</span><span class="va">concept_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    reviewer_value <span class="op">=</span> <span class="va">sample</span><span class="op">$</span><span class="va">concept_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,  <span class="co"># Assume agreement</span></span>
<span>    reviewer_id <span class="op">=</span> <span class="st">"dr_jones"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Check the gate again</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ont_check_gate</span><span class="op">(</span></span>
<span>  <span class="st">"gate_audit_coverage"</span>,</span>
<span>  <span class="st">"high_risk"</span>, <span class="st">"clinical"</span>, <span class="fl">1</span>,</span>
<span>  <span class="st">"activation"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">passed</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">audit_count</span></span>
<span><span class="co">#&gt; [1] 15</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">details</span><span class="op">$</span><span class="va">agreement_rate</span></span>
<span><span class="co">#&gt; [1] 1.0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="satisfying-the-approval-gate">Satisfying the Approval Gate<a class="anchor" aria-label="anchor" href="#satisfying-the-approval-gate"></a>
</h3>
<p>Request and receive approval:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Request approval</span></span>
<span><span class="va">request_id</span> <span class="op">&lt;-</span> <span class="fu">ont_request_approval</span><span class="op">(</span></span>
<span>  <span class="st">"high_risk"</span>, <span class="st">"clinical"</span>, <span class="fl">1</span>,</span>
<span>  requested_action <span class="op">=</span> <span class="st">"activate"</span>,</span>
<span>  requested_by <span class="op">=</span> <span class="st">"data_analyst"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; v Created approval request: REQ-20250116-abc123</span></span>
<span></span>
<span><span class="co"># An approver reviews and approves</span></span>
<span><span class="fu">ont_approve_request</span><span class="op">(</span></span>
<span>  <span class="va">request_id</span>,</span>
<span>  decided_by <span class="op">=</span> <span class="st">"clinical_lead"</span>,</span>
<span>  decision_notes <span class="op">=</span> <span class="st">"Reviewed definition and audit results. Approved for production."</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the gate again</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ont_check_gate</span><span class="op">(</span></span>
<span>  <span class="st">"gate_approval_required"</span>,</span>
<span>  <span class="st">"high_risk"</span>, <span class="st">"clinical"</span>, <span class="fl">1</span>,</span>
<span>  <span class="st">"activation"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">passed</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="the-approval-workflow">The Approval Workflow<a class="anchor" aria-label="anchor" href="#the-approval-workflow"></a>
</h2>
<p>ontologyR provides a complete approval workflow:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Analyst creates definition and requests approval</span></span>
<span><span class="va">request_id</span> <span class="op">&lt;-</span> <span class="fu">ont_request_approval</span><span class="op">(</span></span>
<span>  <span class="st">"new_concept"</span>, <span class="st">"prod"</span>, <span class="fl">1</span>,</span>
<span>  requested_action <span class="op">=</span> <span class="st">"activate"</span>,</span>
<span>  requested_by <span class="op">=</span> <span class="st">"analyst"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Approvers see pending requests</span></span>
<span><span class="va">pending</span> <span class="op">&lt;-</span> <span class="fu">ont_list_pending_approvals</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pending</span></span>
<span><span class="co">#&gt; # A tibble: 1 x 6</span></span>
<span><span class="co">#&gt;   request_id       concept_id  scope version requested_action status</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 REQ-20250116-... new_concept prod        1 activate         pending</span></span>
<span></span>
<span><span class="co"># 3. Approver reviews and decides</span></span>
<span><span class="co"># Option A: Approve</span></span>
<span><span class="fu">ont_approve_request</span><span class="op">(</span><span class="va">request_id</span>, <span class="st">"approver"</span>, <span class="st">"Looks good"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option B: Reject</span></span>
<span><span class="fu">ont_reject_request</span><span class="op">(</span><span class="va">request_id</span>, <span class="st">"approver"</span>, <span class="st">"Needs more audit coverage"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Requester is notified (through your notification system)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="rbac-role-based-access-control">RBAC: Role-Based Access Control<a class="anchor" aria-label="anchor" href="#rbac-role-based-access-control"></a>
</h2>
<p>Not everyone should be able to approve definitions. ontologyR
includes lightweight RBAC.</p>
<div class="section level3">
<h3 id="default-roles">Default Roles<a class="anchor" aria-label="anchor" href="#default-roles"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Role</th>
<th>Can Do</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>viewer</strong></td>
<td>Read concepts, datasets, audits</td>
</tr>
<tr class="even">
<td><strong>editor</strong></td>
<td>Create/edit drafts, run evaluations, record audits</td>
</tr>
<tr class="odd">
<td><strong>approver</strong></td>
<td>Approve activations, override gates</td>
</tr>
<tr class="even">
<td><strong>admin</strong></td>
<td>Everything</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="assigning-roles">Assigning Roles<a class="anchor" aria-label="anchor" href="#assigning-roles"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Grant editor role to a user</span></span>
<span><span class="fu">ont_grant_role</span><span class="op">(</span></span>
<span>  user_id <span class="op">=</span> <span class="st">"alice"</span>,</span>
<span>  role_id <span class="op">=</span> <span class="st">"editor"</span>,</span>
<span>  granted_by <span class="op">=</span> <span class="st">"admin"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Grant approver role scoped to a specific domain</span></span>
<span><span class="fu">ont_grant_role</span><span class="op">(</span></span>
<span>  user_id <span class="op">=</span> <span class="st">"bob"</span>,</span>
<span>  role_id <span class="op">=</span> <span class="st">"approver"</span>,</span>
<span>  scope_type <span class="op">=</span> <span class="st">"domain"</span>,</span>
<span>  scope_value <span class="op">=</span> <span class="st">"clinical"</span>,</span>
<span>  granted_by <span class="op">=</span> <span class="st">"admin"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check what roles a user has</span></span>
<span><span class="fu">ont_get_user_roles</span><span class="op">(</span><span class="st">"bob"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 x 4</span></span>
<span><span class="co">#&gt;   user_id role_id  scope_type scope_value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 bob     approver domain     clinical</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-permissions">Checking Permissions<a class="anchor" aria-label="anchor" href="#checking-permissions"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Can this user approve things?</span></span>
<span><span class="fu">ont_check_permission</span><span class="op">(</span><span class="st">"alice"</span>, <span class="st">"concept:approve"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="fu">ont_check_permission</span><span class="op">(</span><span class="st">"bob"</span>, <span class="st">"concept:approve"</span>, scope_type <span class="op">=</span> <span class="st">"domain"</span>, scope_value <span class="op">=</span> <span class="st">"clinical"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Require permission (throws error if not permitted)</span></span>
<span><span class="fu">ont_require_permission</span><span class="op">(</span><span class="st">"alice"</span>, <span class="st">"concept:write"</span><span class="op">)</span>  <span class="co"># OK, editors can write</span></span>
<span><span class="fu">ont_require_permission</span><span class="op">(</span><span class="st">"alice"</span>, <span class="st">"concept:activate"</span><span class="op">)</span>  <span class="co"># Error!</span></span>
<span><span class="co">#&gt; Error: User 'alice' lacks permission 'concept:activate'.</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="custom-gates">Custom Gates<a class="anchor" aria-label="anchor" href="#custom-gates"></a>
</h2>
<p>You can create custom gates for your organization’s needs:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Gate requiring minimum sample size</span></span>
<span><span class="fu">ont_create_gate</span><span class="op">(</span></span>
<span>  gate_id <span class="op">=</span> <span class="st">"gate_min_sample_size"</span>,</span>
<span>  gate_name <span class="op">=</span> <span class="st">"Minimum Sample Size"</span>,</span>
<span>  gate_type <span class="op">=</span> <span class="st">"custom"</span>,</span>
<span>  applies_to <span class="op">=</span> <span class="st">"activation"</span>,</span>
<span>  conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    min_population <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    description <span class="op">=</span> <span class="st">"Concept must apply to at least 100 objects"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  severity <span class="op">=</span> <span class="st">"warning"</span>  <span class="co"># Warning, not blocking</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gate requiring documentation</span></span>
<span><span class="fu">ont_create_gate</span><span class="op">(</span></span>
<span>  gate_id <span class="op">=</span> <span class="st">"gate_has_description"</span>,</span>
<span>  gate_name <span class="op">=</span> <span class="st">"Description Required"</span>,</span>
<span>  gate_type <span class="op">=</span> <span class="st">"custom"</span>,</span>
<span>  applies_to <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>check <span class="op">=</span> <span class="st">"description IS NOT NULL"</span><span class="op">)</span>,</span>
<span>  severity <span class="op">=</span> <span class="st">"blocking"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="overriding-gates">Overriding Gates<a class="anchor" aria-label="anchor" href="#overriding-gates"></a>
</h2>
<p>Sometimes you need to bypass a gate (emergency deployment, etc.).
ontologyR allows this with full audit trail:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check a gate that fails</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">ont_check_gate</span><span class="op">(</span></span>
<span>  <span class="st">"gate_audit_coverage"</span>,</span>
<span>  <span class="st">"emergency_concept"</span>, <span class="st">"prod"</span>, <span class="fl">1</span>,</span>
<span>  <span class="st">"activation"</span>,</span>
<span>  checked_by <span class="op">=</span> <span class="st">"analyst"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">passed</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span></span>
<span><span class="co"># Override with documented reason</span></span>
<span><span class="fu">ont_override_gate</span><span class="op">(</span></span>
<span>  check_id <span class="op">=</span> <span class="va">result</span><span class="op">$</span><span class="va">check_id</span>,</span>
<span>  override_reason <span class="op">=</span> <span class="st">"Emergency deployment approved by CTO. Will complete audits within 48 hours."</span>,</span>
<span>  overridden_by <span class="op">=</span> <span class="st">"admin_user"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; v Gate check REQ-... overridden</span></span>
<span></span>
<span><span class="co"># The override is recorded in history</span></span>
<span><span class="fu">ont_get_gate_history</span><span class="op">(</span><span class="st">"emergency_concept"</span>, <span class="st">"prod"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Shows the failed check and override reason</span></span></code></pre></div>
<p><strong>The Emergency Exit Analogy</strong>: Fire exits exist for
emergencies, but using one triggers an alarm and is logged. Gate
overrides work the same way — possible when necessary, but always
recorded.</p>
<hr>
</div>
<div class="section level2">
<h2 id="gate-history-the-audit-trail">Gate History: The Audit Trail<a class="anchor" aria-label="anchor" href="#gate-history-the-audit-trail"></a>
</h2>
<p>Every gate check is recorded:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">history</span> <span class="op">&lt;-</span> <span class="fu">ont_get_gate_history</span><span class="op">(</span><span class="st">"high_risk"</span>, <span class="st">"clinical"</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">history</span></span>
<span><span class="co">#&gt; # A tibble: 5 x 8</span></span>
<span><span class="co">#&gt;   check_id        gate_id             check_result checked_at          checked_by</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;           &lt;chr&gt;               &lt;chr&gt;        &lt;dttm&gt;              &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 CHK-20250116-a gate_audit_coverage  passed       2025-01-16 14:30:00 analyst</span></span>
<span><span class="co">#&gt; 2 CHK-20250116-b gate_no_open_drift   passed       2025-01-16 14:30:01 analyst</span></span>
<span><span class="co">#&gt; 3 CHK-20250116-c gate_approval_req... passed       2025-01-16 14:30:02 analyst</span></span>
<span><span class="co">#&gt; 4 CHK-20250115-d gate_audit_coverage  failed       2025-01-15 10:00:00 analyst</span></span>
<span><span class="co">#&gt; 5 CHK-20250115-e gate_audit_coverage  failed       2025-01-15 09:00:00 analyst</span></span></code></pre></div>
<p>This answers: <strong>“Why couldn’t we activate this
yesterday?”</strong></p>
<hr>
</div>
<div class="section level2">
<h2 id="practical-example-concept-promotion-workflow">Practical Example: Concept Promotion Workflow<a class="anchor" aria-label="anchor" href="#practical-example-concept-promotion-workflow"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CathalByrneGit/ontologyR" class="external-link">ontologyR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_connect.html">ont_connect</a></span><span class="op">(</span><span class="st">":memory:"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Setup ===</span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span><span class="fu"><a href="../reference/ont_get_connection.html">ont_get_connection</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"orders"</span>, <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  order_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span>,</span>
<span>  amount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">10</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"complete"</span>, <span class="st">"pending"</span>, <span class="st">"cancelled"</span><span class="op">)</span>, <span class="fl">500</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_register_object.html">ont_register_object</a></span><span class="op">(</span><span class="st">"Order"</span>, <span class="st">"orders"</span>, <span class="st">"order_id"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Step 1: Create Draft Definition ===</span></span>
<span><span class="fu"><a href="../reference/ont_define_concept.html">ont_define_concept</a></span><span class="op">(</span><span class="st">"high_value_order"</span>, <span class="st">"Order"</span>,</span>
<span>                    description <span class="op">=</span> <span class="st">"Orders above $500"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ont_add_version.html">ont_add_version</a></span><span class="op">(</span><span class="st">"high_value_order"</span>, <span class="st">"finance"</span>, <span class="fl">1</span>,</span>
<span>                 sql_expr <span class="op">=</span> <span class="st">"amount &gt; 500"</span>,</span>
<span>                 status <span class="op">=</span> <span class="st">"draft"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Step 2: Check Gates (expect failure) ===</span></span>
<span><span class="va">gates</span> <span class="op">&lt;-</span> <span class="fu">ont_check_all_gates</span><span class="op">(</span><span class="st">"high_value_order"</span>, <span class="st">"finance"</span>, <span class="fl">1</span>, <span class="st">"activation"</span><span class="op">)</span></span>
<span><span class="va">gates</span><span class="op">$</span><span class="va">overall_passed</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co"># Missing audits and approval</span></span>
<span></span>
<span><span class="co"># === Step 3: Conduct Audits ===</span></span>
<span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ont_sample_for_audit.html">ont_sample_for_audit</a></span><span class="op">(</span><span class="st">"high_value_order"</span>, <span class="st">"finance"</span>, n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># In reality, a human would review each one</span></span>
<span>  <span class="fu"><a href="../reference/ont_record_audit.html">ont_record_audit</a></span><span class="op">(</span></span>
<span>    <span class="st">"high_value_order"</span>, <span class="st">"finance"</span>, <span class="fl">1</span>,</span>
<span>    <span class="va">sample</span><span class="op">$</span><span class="va">order_id</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    system_value <span class="op">=</span> <span class="va">sample</span><span class="op">$</span><span class="va">concept_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    reviewer_value <span class="op">=</span> <span class="va">sample</span><span class="op">$</span><span class="va">concept_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    reviewer_id <span class="op">=</span> <span class="st">"finance_analyst"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># === Step 4: Request Approval ===</span></span>
<span><span class="va">request_id</span> <span class="op">&lt;-</span> <span class="fu">ont_request_approval</span><span class="op">(</span></span>
<span>  <span class="st">"high_value_order"</span>, <span class="st">"finance"</span>, <span class="fl">1</span>,</span>
<span>  <span class="st">"activate"</span>,</span>
<span>  requested_by <span class="op">=</span> <span class="st">"finance_analyst"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Step 5: Approver Reviews ===</span></span>
<span><span class="fu">ont_approve_request</span><span class="op">(</span><span class="va">request_id</span>, <span class="st">"finance_manager"</span>, <span class="st">"Verified against business rules"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># === Step 6: Check Gates Again ===</span></span>
<span><span class="va">gates</span> <span class="op">&lt;-</span> <span class="fu">ont_check_all_gates</span><span class="op">(</span><span class="st">"high_value_order"</span>, <span class="st">"finance"</span>, <span class="fl">1</span>, <span class="st">"activation"</span><span class="op">)</span></span>
<span><span class="va">gates</span><span class="op">$</span><span class="va">overall_passed</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># === Step 7: Activate! ===</span></span>
<span><span class="fu"><a href="../reference/ont_activate_version.html">ont_activate_version</a></span><span class="op">(</span><span class="st">"high_value_order"</span>, <span class="st">"finance"</span>, <span class="fl">1</span>, activated_by <span class="op">=</span> <span class="st">"finance_manager"</span><span class="op">)</span></span>
<span><span class="co">#&gt; v Activated high_value_order@finance v1</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="key-concepts-summary">Key Concepts Summary<a class="anchor" aria-label="anchor" href="#key-concepts-summary"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th>Concept</th>
<th>What It Is</th>
<th>Analogy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Gate</strong></td>
<td>Checkpoint before action</td>
<td>Airport security</td>
</tr>
<tr class="even">
<td><strong>Gate Check</strong></td>
<td>Single evaluation of a gate</td>
<td>Going through scanner</td>
</tr>
<tr class="odd">
<td><strong>Blocking Gate</strong></td>
<td>Must pass to proceed</td>
<td>Passport control</td>
</tr>
<tr class="even">
<td><strong>Warning Gate</strong></td>
<td>Advises but doesn’t block</td>
<td>Advisory signs</td>
</tr>
<tr class="odd">
<td><strong>Override</strong></td>
<td>Bypass with documentation</td>
<td>Emergency exit</td>
</tr>
<tr class="even">
<td><strong>Role</strong></td>
<td>Set of permissions</td>
<td>Job title</td>
</tr>
<tr class="odd">
<td><strong>Permission</strong></td>
<td>Single allowed action</td>
<td>Key card access</td>
</tr>
<tr class="even">
<td><strong>Approval</strong></td>
<td>Human sign-off</td>
<td>Signature</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="why-this-matters">Why This Matters<a class="anchor" aria-label="anchor" href="#why-this-matters"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th>Without Governance</th>
<th>With Governance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Anyone can change definitions</td>
<td>Changes require authorization</td>
</tr>
<tr class="even">
<td>No testing required</td>
<td>Must pass audit coverage</td>
</tr>
<tr class="odd">
<td>Drift can be ignored</td>
<td>Must resolve drift events</td>
</tr>
<tr class="even">
<td>Changes happen silently</td>
<td>Full audit trail</td>
</tr>
<tr class="odd">
<td>“Who approved this?”</td>
<td>Clear approval records</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>See <code><a href="../articles/introduction.html">vignette("introduction")</a></code> for core concepts</li>
<li>See <code><a href="../articles/datasets-and-materialization.html">vignette("datasets-and-materialization")</a></code> for data
assets</li>
<li>See <code><a href="../articles/transforms-and-lineage.html">vignette("transforms-and-lineage")</a></code> for data
pipelines</li>
</ul>
<p>Remember: <strong>Good governance isn’t about slowing things down —
it’s about moving fast with confidence.</strong></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cathal Byrne.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
